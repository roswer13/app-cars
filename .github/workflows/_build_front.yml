name: 📱🔨 Build Frontend

on:
  workflow_call:

jobs:
  testAndCoverage:
    name: 🧪 Test
    uses: ./.github/workflows/_test_front_with_coverage.yml
    secrets: inherit

  analyze:
    name: Analyze
    if: github.event.pull_request.draft == false
    timeout-minutes: 30
    runs-on: ubuntu-latest

    steps:
      - name: ⬇️ Checkout repository
        uses: actions/checkout@v3

      - name: ⚙️ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true

      - name: ⚙️ Flutter pub get
        working-directory: app_cars_front
        run: flutter pub get

      - name: 📡 Run flutter analyze
        working-directory: app_cars_front
        run: |
          flutter analyze > ../analysis_output.txt || true

      - name: 📈 Check for code issues
        id: code-issues
        run: |
          if grep -q "error •" analysis_output.txt; then
            echo "::error::Code analysis failed"
            exit 1
          else
            echo "Code analysis passed"
          fi

      - name: 📄 Upload analysis results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: analysis-results
          path: app_cars_front/analysis_output.txt